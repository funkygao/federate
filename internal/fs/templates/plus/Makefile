# Generated by federate, DO NOT EDIT.
SHELL := /bin/bash
.SILENT:

FEDERATE_CMD ?= federate
INVENTORY_CMD := $(FEDERATE_CMD) util inventory

help: 
	awk 'BEGIN {FS = ":.*##"; printf "Usage:\n  make \033[36m<target>\033[0m\n"} /^[a-zA-Z_0-9-]+:.*?##/ { printf "  \033[36m%-16s\033[0m %s\n", $$1, $$2 } /^##@/ { printf "\n\033[1m%s\033[0m\n", substr($$0, 5) } /^##[^@]/ { printf "%s\n", substr($$0, 4) }' $(MAKEFILE_LIST)

##@ WMS6 Kernel

sync: ## Synchronize local WMS6 kernel with latest remote main branch.
	$(MAKE) restore-submodules
	echo "‚òïÔ∏è Syncing all submodules repository" 
	git submodule update --init --recursive --remote
	echo "üç∫ Submodules are latest"

install: ## Local install WMS6 kernel with src attached for Plus Development.
	for repo in $$($(INVENTORY_CMD) -f components); do \
		echo "Installing $$repo ..."; \
		(cd $$repo && mvn install source:jar install:install -T8 -Dmaven.artifact.threads=16 -Dmaven.test.skip=true -Dfederate.packaging=true) || exit 1; \
	done

clean:restore-submodules
	rm -rf generated

diff:
	git submodule foreach --recursive 'git diff --ignore-space-at-eol -w -b'

restore-submodules:
	echo "‚òïÔ∏è Restoring submodules repository ..."
	for repo in $$($(INVENTORY_CMD) -f repo-list); do \
		if [ -d "$$repo" ]; then \
			echo "   Checking out $$repo"; \
			(cd $$repo && git checkout -q .) || echo "Failed to checkout $$repo"; \
		fi; \
	done

##@ Plus Development

scaffold: ## Scaffold project structure based on latest manifest.yaml.
	federate wms-plus scaffold

snap: ## Create a secure, tailored source code snapshot for customer delivery.
	federate wms-plus snap --yes=true

run: ## Debug {{.AppName}} locally.
	java -DappName={{.AppName}} -DLOG_HOME=. -Xss1m -server -classpath target/{{.AppName}}-1.0.0-SNAPSHOT-package/conf:target/{{.AppName}}-1.0.0-SNAPSHOT-package/lib/* {{.ClassName}}

package: ## Compile and package {{.AppName}}.
	mvn package -T 1C -Dmaven.artifact.threads=2C

rpmdist:package ## Create deployable RPM artifact for {{.AppName}}.
	federate image build-rpm --app-name {{.AppName}} --app-source-path {{.AppSrc}} --jvm-size {{.JvmSize}} --main-module {{.ClassName}} --tomcat-port {{.TomcatPort}}
